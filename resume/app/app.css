/* ======= tokens (app-wide only) ======================================= */
:root{
  --accent:#8b5cf6; --accent2:#d946ef;
  --ink:#e6e8ef; --ink-d:#0e1117;
  --bg:#0e1117; --panel:#0f1420; --line:#23283b; --card:#ffffff;
  --shadow:0 10px 30px rgba(0,0,0,.25);
  --rail:300px;
  --page-w:860px;
  --chipBg: #fff; /* default chip background unless set by setYearChipTint */
  /* section/card color tokens (will switch with dark mode) */
  --secBg: #ffffff;
  --cardBg: rgba(0,0,0,0.03);
  --cardBorder: rgba(0,0,0,0.08);
}
body[data-theme="coral"]{ --accent:#ff7b54; --accent2:#ffd166 }
body[data-theme="sea"]{ --accent:#4facfe; --accent2:#38d2ff }
body[data-theme="city"]{ --accent:#34d399; --accent2:#9ca3af }
body[data-theme="magentaPurple"]{ --accent:#c026d3; --accent2:#9333ea }
body[data-theme="magentaPink"]{ --accent:#ec4899; --accent2:#f97316 }
body[data-theme="blueGreen"]{ --accent:#22c1c3; --accent2:#2ecc71 }
body[data-theme="grayBlack"]{ --accent:#8892a6; --accent2:#414b57 }

/* ======= base ========================================================== */
*{box-sizing:border-box} html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--ink);
  font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;
  display:grid;grid-template-rows:auto 1fr}
a{color:inherit;text-decoration:none}

/* ======= top bar ======================================================= */
.nav{position:sticky;top:0;z-index:10000;display:flex;justify-content:center;gap:10px;align-items:center;
  padding:10px 14px;background:linear-gradient(180deg,#0b0f19,rgba(11,15,25,.85));
  border-bottom:1px solid #1d2336;backdrop-filter:blur(8px)}
.brand{font-weight:800}
.menu{display:flex;gap:10px;align-items:center;padding:6px 10px;border-radius:14px;background:#0f1420;border:1px solid #1f2540;box-shadow:0 10px 30px rgba(0,0,0,.25)}
.mbtn{appearance:none;border:1px solid #2b324b;background:#12182a;color:#e6e8ef;padding:7px 10px;border-radius:12px;cursor:pointer}
.mbtn:hover{box-shadow:0 0 0 3px rgba(99,102,241,.25) inset}
.dropdown{position:relative}
.dropdown-menu{position:absolute;top:120%;left:0;background:#0f1420;border:1px solid var(--line);border-radius:12px;min-width:260px;box-shadow:0 20px 60px rgba(0,0,0,.35);display:none;padding:10px;z-index:9999}
.dropdown.open .dropdown-menu{display:block}

/* theme pop */
.theme-pop{min-width:340px}
.theme-row{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
.swatch{height:42px;border-radius:12px;border:1px solid #2b324b;cursor:pointer;background:linear-gradient(135deg,var(--a1),var(--a2));position:relative;overflow:hidden}
.swatch:active::after{content:"";position:absolute;inset:-60px;pointer-events:none;background:radial-gradient(circle at center, #fff6 0 8px, #fff0 9px) no-repeat center/120px 120px;animation:spark .6s ease}
@keyframes spark{from{opacity:1;transform:scale(.6)}to{opacity:0;transform:scale(1.6)}}
.swatch[data-k="coral"]{--a1:#ff7b54;--a2:#ffd166}
.swatch[data-k="sea"]{--a1:#4facfe;--a2:#38d2ff}
.swatch[data-k="city"]{--a1:#34d399;--a2:#9ca3af}
.swatch[data-k="magentaPurple"]{--a1:#c026d3;--a2:#9333ea}
.swatch[data-k="magentaPink"]{--a1:#ec4899;--a2:#f97316}
.swatch[data-k="blueGreen"]{--a1:#22c1c3;--a2:#2ecc71}
.swatch[data-k="grayBlack"]{--a1:#8892a6;--a2:#414b57}
.k-row{display:flex;align-items:center;gap:8px;margin-top:12px}
.k-row input[type=color]{width:28px;height:28px;border:0;border-radius:8px;cursor:pointer}
.switch{width:46px;height:26px;border-radius:999px;background:#2a314a;border:1px solid #3b4569;position:relative;cursor:pointer}
.switch::after{content:"";position:absolute;top:3px;left:3px;width:20px;height:20px;border-radius:50%;background:#cfd6ff;transition:left .18s ease}
.switch.on{background:#3b82f6}
.switch.on::after{left:23px}

/* ======= canvas page ==================================================== */
#canvas-root{display:flex;justify-content:center;overflow:auto;padding:18px}
.page{background:transparent;color:var(--ink);min-height:1200px;position:relative}
#sheet{padding:24px;min-height:1120px}
[data-dark="1"] #sheet{ background:#0d1220; color:var(--ink); }
.stack{display:grid;grid-template-columns:repeat(12,minmax(0,1fr));gap:16px;align-content:start}

/* Sidebar rail tweaks: keep content top-aligned, center avatar only */
.sidebar-layout .rail{ display:flex; flex-direction:column; align-items:flex-start }
.sidebar-layout .rail .avatar{ margin:18px auto; display:block }

/* Make main zone occupy full inner width and remove extra padding that could offset children */
.sidebar-layout [data-zone="main"]{ padding:0 }

/* Ensure any .node wrapper directly inside the page stack spans the full 12-column width.
   This prevents header/node wrappers (like the sidebar header) from being placed into a
   single grid column which constrains inner .sidebar-layout to a tiny width. */
.stack > .node{
  grid-column: 1 / -1 !important;
  width: 100% !important;
  max-width: none !important;
  min-width: 0 !important;
  box-sizing: border-box !important;
}

/* Add button centering improvements */
.add-squircle{grid-column:1/-1;display:flex;justify-content:center;align-items:center;padding:28px 0}
.add-dot{display:flex;align-items:center;justify-content:center}
*** End Patch

/* plus button */
.add-squircle{grid-column:1/-1;display:flex;justify-content:center;padding:28px 0}
.add-dot{width:86px;height:86px;border-radius:22px;border:2px dashed #a3aed0;display:grid;place-items:center;color:#64748b;cursor:pointer;background:#fff;box-shadow:var(--shadow);font-size:28px;font-weight:900}
.add-dot:hover{border-color:#7c99ff;color:#7c99ff}

/* Force sections and cards to occupy the full canvas area inside sidebar main */
.sidebar-layout [data-zone="main"] > .section,
.sidebar-layout [data-zone="main"] > #canvasAdd{
  grid-column: 1 / -1 !important;
  width: 100% !important;
  max-width: none !important;
  min-width: 0 !important;
  box-sizing: border-box;
}

.sidebar-layout [data-zone="main"] .card{ width:100%; box-sizing:border-box }

/* Ensure the node wrapper spans the full grid and cannot be shrunk by children */
.sidebar-layout [data-zone="main"] > .node{
  grid-column: 1 / -1 !important;
  width: 100% !important;
  max-width: none !important;
  min-width: 0 !important;
}

/* floating add menu (shared) */
.pop{position:fixed;background:#0f1420;border:1px solid var(--line);border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,.35);padding:10px;display:none;z-index:18000}
.pop.open{display:block}
.pop .tray{display:flex;gap:10px}
.pop .sq{width:48px;height:48px;border-radius:12px;border:1px solid #293255;background:#12182a;color:#e6e8ef;display:grid;place-items:center;cursor:pointer;box-shadow:0 12px 32px rgba(0,0,0,.35)}
.pop .sq:hover{box-shadow:0 0 0 3px rgba(124,153,255,.25) inset}

/* preview + print */
.preview .add-dot{display:none!important}
@media print{ .nav,.pop,[data-overlay]{display:none!important} .page{box-shadow:none} }

/* keep debug helpers removed in cleanup; the sanitization/observer code still runs in JS */

/* Ensure node wrappers inside the sidebar main can't be shrunk by intrinsic child sizing. */
.sidebar-layout [data-zone="main"] > .node{
  grid-column: 1 / -1;
  width: 100%;
  max-width: none;
  min-width: 0;
  box-sizing: border-box;
}

/* Ensure immediate children (cards/sections) adopt full width inside node */
.sidebar-layout [data-zone="main"] .node > .section,
.sidebar-layout [data-zone="main"] .node .card{
  width: 100%;
  max-width: none;
  min-width: 0;
  box-sizing: border-box;
}
